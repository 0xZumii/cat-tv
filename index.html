<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cat TV</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Fredoka:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-warm: #FFF8F0;
      --bg-card: #FFFFFF;
      --accent-orange: #FF8C42;
      --accent-pink: #FFB4B4;
      --accent-mint: #B8E0D2;
      --accent-lavender: #D4A5FF;
      --text-main: #4A4A4A;
      --text-soft: #8B8B8B;
      --happy: #7ED957;
      --okay: #FFD93D;
      --sad: #FF6B6B;
      --shadow-soft: 0 4px 20px rgba(255, 140, 66, 0.15);
      --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.08);
      --radius: 24px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg-warm);
      color: var(--text-main);
      min-height: 100vh;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(255, 180, 180, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(184, 224, 210, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 60% 10%, rgba(212, 165, 255, 0.2) 0%, transparent 40%);
      pointer-events: none;
      z-index: -1;
    }

    header {
      padding: 20px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      font-family: 'Fredoka', sans-serif;
      font-size: 28px;
      font-weight: 600;
      color: var(--accent-orange);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .logo-icon {
      font-size: 32px;
    }

    .balance-pill {
      background: var(--bg-card);
      border-radius: 50px;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: var(--shadow-soft);
      font-weight: 700;
      color: var(--accent-orange);
    }

    .balance-icon {
      font-size: 20px;
    }

    .balance-amount {
      font-size: 18px;
      min-width: 24px;
      text-align: center;
    }

    .hero {
      text-align: center;
      padding: 40px 24px 60px;
      max-width: 600px;
      margin: 0 auto;
    }

    .hero h1 {
      font-family: 'Fredoka', sans-serif;
      font-size: clamp(36px, 8vw, 56px);
      font-weight: 600;
      color: var(--text-main);
      margin-bottom: 16px;
      line-height: 1.1;
    }

    .hero h1 span {
      color: var(--accent-orange);
    }

    .hero p {
      font-size: 18px;
      color: var(--text-soft);
      line-height: 1.6;
      margin-bottom: 32px;
    }

    .claim-section {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .claim-btn {
      background: linear-gradient(135deg, var(--accent-orange) 0%, #FF6B42 100%);
      border: none;
      border-radius: 50px;
      padding: 16px 36px;
      font-family: 'Nunito', sans-serif;
      font-size: 18px;
      font-weight: 700;
      color: white;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(255, 140, 66, 0.4);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .claim-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(255, 140, 66, 0.5);
    }

    .claim-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .claim-btn:disabled {
      background: linear-gradient(135deg, #CCC 0%, #AAA 100%);
      box-shadow: none;
      cursor: not-allowed;
    }

    .claim-btn.claimed {
      background: linear-gradient(135deg, var(--accent-mint) 0%, #8BD4BE 100%);
      box-shadow: 0 8px 24px rgba(184, 224, 210, 0.4);
    }

    .next-claim {
      font-size: 14px;
      color: var(--text-soft);
      text-align: center;
    }

    .stats-bar {
      display: flex;
      justify-content: center;
      gap: 40px;
      padding: 20px;
      margin-bottom: 40px;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-family: 'Fredoka', sans-serif;
      font-size: 28px;
      font-weight: 600;
      color: var(--accent-orange);
    }

    .stat-label {
      font-size: 14px;
      color: var(--text-soft);
    }

    .cat-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
      padding: 0 24px 80px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Upload Card */
    .upload-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-card);
      border: 3px dashed var(--accent-pink);
      transition: all 0.3s ease;
      cursor: pointer;
      min-height: 360px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      padding: 40px;
    }

    .upload-card:hover {
      border-color: var(--accent-orange);
      transform: translateY(-4px);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
    }

    .upload-card.dragover {
      border-color: var(--accent-orange);
      background: rgba(255, 140, 66, 0.05);
    }

    .upload-icon {
      font-size: 64px;
      opacity: 0.8;
    }

    .upload-text {
      font-family: 'Fredoka', sans-serif;
      font-size: 20px;
      color: var(--text-main);
    }

    .upload-subtext {
      font-size: 14px;
      color: var(--text-soft);
    }

    #file-input {
      display: none;
    }

    /* Cat Card */
    .cat-card {
      background: var(--bg-card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow-card);
      transition: all 0.3s ease;
    }

    .cat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
    }

    .cat-image-container {
      position: relative;
      aspect-ratio: 1;
      overflow: hidden;
      background: linear-gradient(135deg, var(--accent-pink) 0%, var(--accent-lavender) 100%);
    }

    .cat-image, .cat-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
    }

    .cat-card:hover .cat-image,
    .cat-card:hover .cat-video {
      transform: scale(1.05);
    }

    .happiness-badge {
      position: absolute;
      top: 16px;
      right: 16px;
      background: var(--bg-card);
      border-radius: 50px;
      padding: 8px 14px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .happiness-badge.happy { color: var(--happy); }
    .happiness-badge.okay { color: var(--okay); }
    .happiness-badge.sad { color: var(--sad); }

    .happiness-face {
      font-size: 18px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .happiness-badge.sad .happiness-face {
      animation: shake 0.5s ease-in-out infinite;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }

    .cat-info {
      padding: 20px;
    }

    .cat-name {
      font-family: 'Fredoka', sans-serif;
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .cat-fed-count {
      font-size: 14px;
      color: var(--text-soft);
      margin-bottom: 16px;
    }

    .feed-btn {
      width: 100%;
      background: linear-gradient(135deg, var(--accent-orange) 0%, #FF6B42 100%);
      border: none;
      border-radius: 16px;
      padding: 14px;
      font-family: 'Nunito', sans-serif;
      font-size: 16px;
      font-weight: 700;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .feed-btn:hover:not(:disabled) {
      box-shadow: 0 8px 20px rgba(255, 140, 66, 0.4);
      transform: translateY(-2px);
    }

    .feed-btn:disabled {
      background: linear-gradient(135deg, #E0E0E0 0%, #CCCCCC 100%);
      cursor: not-allowed;
    }

    .feed-btn.feeding {
      animation: feedPulse 0.6s ease;
    }

    @keyframes feedPulse {
      0% { transform: scale(1); }
      50% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }

    .feed-particles {
      position: absolute;
      top: 50%;
      left: 50%;
      pointer-events: none;
      z-index: 10;
    }

    .heart {
      position: absolute;
      font-size: 24px;
      animation: floatUp 1s ease-out forwards;
      opacity: 0;
    }

    @keyframes floatUp {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(0);
      }
      50% {
        opacity: 1;
        transform: translate(-50%, -100px) scale(1.2);
      }
      100% {
        opacity: 0;
        transform: translate(-50%, -150px) scale(0.8);
      }
    }

    /* Upload Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 32px;
      max-width: 400px;
      width: 90%;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .modal-overlay.show .modal {
      transform: scale(1);
    }

    .modal h2 {
      font-family: 'Fredoka', sans-serif;
      font-size: 24px;
      margin-bottom: 24px;
      text-align: center;
    }

    .modal-preview {
      width: 100%;
      aspect-ratio: 1;
      border-radius: 16px;
      overflow: hidden;
      background: linear-gradient(135deg, var(--accent-pink) 0%, var(--accent-lavender) 100%);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-preview img,
    .modal-preview video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .modal-preview-placeholder {
      font-size: 48px;
    }

    .modal-input {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid #EEE;
      border-radius: 12px;
      font-family: 'Nunito', sans-serif;
      font-size: 16px;
      margin-bottom: 16px;
      transition: border-color 0.3s ease;
    }

    .modal-input:focus {
      outline: none;
      border-color: var(--accent-orange);
    }

    .modal-actions {
      display: flex;
      gap: 12px;
    }

    .modal-btn {
      flex: 1;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-family: 'Nunito', sans-serif;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .modal-btn.primary {
      background: linear-gradient(135deg, var(--accent-orange) 0%, #FF6B42 100%);
      color: white;
    }

    .modal-btn.primary:hover {
      box-shadow: 0 8px 20px rgba(255, 140, 66, 0.4);
    }

    .modal-btn.secondary {
      background: #EEE;
      color: var(--text-main);
    }

    .modal-btn.secondary:hover {
      background: #E0E0E0;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-card);
      border-radius: 16px;
      padding: 16px 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 100;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    .toast.success {
      border-left: 4px solid var(--happy);
    }

    .toast.error {
      border-left: 4px solid var(--sad);
    }

    /* About Section */
    .about-section {
      background: var(--bg-card);
      padding: 60px 24px;
      text-align: center;
    }

    .about-content {
      max-width: 600px;
      margin: 0 auto;
    }

    .about-section h2 {
      font-family: 'Fredoka', sans-serif;
      font-size: 32px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-main);
    }

    .about-section p {
      font-size: 16px;
      line-height: 1.8;
      color: var(--text-soft);
      margin-bottom: 16px;
    }

    .about-features {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .feature {
      text-align: center;
      max-width: 200px;
    }

    .feature-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .feature h3 {
      font-family: 'Fredoka', sans-serif;
      font-size: 18px;
      margin-bottom: 8px;
    }

    .feature p {
      font-size: 14px;
      margin-bottom: 0;
    }

    footer {
      text-align: center;
      padding: 40px 24px;
      color: var(--text-soft);
      font-size: 14px;
    }

    footer a {
      color: var(--accent-orange);
      text-decoration: none;
    }

    @media (max-width: 600px) {
      header {
        padding: 16px;
      }
      
      .logo {
        font-size: 22px;
      }
      
      .balance-pill {
        padding: 8px 16px;
      }
      
      .hero {
        padding: 24px 16px 40px;
      }
      
      .stats-bar {
        gap: 24px;
      }
      
      .cat-grid {
        padding: 0 16px 60px;
        gap: 16px;
      }
      
      .about-features {
        gap: 24px;
      }

      .upload-card {
        min-height: 280px;
        padding: 24px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <span class="logo-icon">üê±</span>
      <span>Cat TV</span>
    </div>
    <div class="balance-pill">
      <span class="balance-icon">üêü</span>
      <span class="balance-amount" id="balance">0</span>
    </div>
  </header>

  <main>
    <section class="hero">
      <h1>Take care of <span>cats</span> together</h1>
      <p>Claim your daily cat food and help keep our community cats happy and fed. Every meal counts.</p>
      
      <div class="claim-section">
        <button class="claim-btn" id="claim-btn" onclick="claimDaily()">
          <span>üéÅ</span>
          <span id="claim-text">Claim Daily Food</span>
        </button>
      </div>
      <p class="next-claim" id="next-claim"></p>
    </section>

    <div class="stats-bar">
      <div class="stat">
        <div class="stat-value" id="total-feeds">0</div>
        <div class="stat-label">Total Feeds</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="happy-cats">0</div>
        <div class="stat-label">Happy Cats</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="total-cats">0</div>
        <div class="stat-label">Cats</div>
      </div>
    </div>

    <section class="cat-grid" id="cat-grid">
      <!-- Upload card + Cat cards injected here -->
    </section>

    <section class="about-section">
      <div class="about-content">
        <h2>How it works</h2>
        <p>Cat TV is a collective care experiment. Each day, you receive 100 cat food tokens. Use them to feed any cat you'd like ‚Äî each feeding costs 10 tokens, so you can care for 10 cats daily.</p>
        <p>When you feed a cat, 70% fills their bowl (and eventually returns to the community pool), while 30% goes to our Care Fund for real shelter donations. It's a circular economy built on care.</p>
        
        <div class="about-features">
          <div class="feature">
            <div class="feature-icon">üéÅ</div>
            <h3>Daily Allowance</h3>
            <p>Claim free cat food every 24 hours</p>
          </div>
          <div class="feature">
            <div class="feature-icon">üò∏</div>
            <h3>Happy Cats</h3>
            <p>Fed cats show their happiness</p>
          </div>
          <div class="feature">
            <div class="feature-icon">ü§ù</div>
            <h3>Community Care</h3>
            <p>Everyone helps keep cats fed</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>Built with üíõ for cats everywhere</p>
  </footer>

  <!-- Toast -->
  <div class="toast" id="toast">
    <span id="toast-icon">‚ú®</span>
    <span id="toast-message">Message</span>
  </div>

  <!-- Upload Modal -->
  <div class="modal-overlay" id="modal-overlay" onclick="closeModalOutside(event)">
    <div class="modal">
      <h2>Add a Cat üê±</h2>
      <div class="modal-preview" id="modal-preview">
        <span class="modal-preview-placeholder">üì∑</span>
      </div>
      <input type="text" class="modal-input" id="cat-name-input" placeholder="Cat's name" maxlength="20">
      <div class="modal-actions">
        <button class="modal-btn secondary" onclick="closeModal()">Cancel</button>
        <button class="modal-btn primary" id="add-cat-btn" onclick="addCat()">Add Cat</button>
      </div>
    </div>
  </div>

  <!-- Hidden file input -->
  <input type="file" id="file-input" accept="image/*,video/*" onchange="handleFileSelect(event)">

  <script>
    // ============================================
    // STATE
    // ============================================
    const DAILY_AMOUNT = 100;
    const FEED_COST = 10;
    const CLAIM_COOLDOWN_MS = 24 * 60 * 60 * 1000;

    let state = {
      balance: 0,
      lastClaimAt: null,
      totalFeeds: 0,
      userId: null
    };

    let cats = [];
    let pendingFile = null;

    // ============================================
    // HELPERS
    // ============================================
    function getHappiness(lastFedAt) {
      if (!lastFedAt) return { level: 'sad', emoji: 'üòø', label: 'Hungry' };
      const hoursSinceFed = (Date.now() - lastFedAt) / (1000 * 60 * 60);
      if (hoursSinceFed < 6) return { level: 'happy', emoji: 'üò∏', label: 'Happy' };
      if (hoursSinceFed < 24) return { level: 'okay', emoji: 'üôÇ', label: 'Okay' };
      return { level: 'sad', emoji: 'üòø', label: 'Hungry' };
    }

    function canClaim() {
      if (!state.lastClaimAt) return true;
      return Date.now() - state.lastClaimAt >= CLAIM_COOLDOWN_MS;
    }

    function getTimeUntilClaim() {
      if (!state.lastClaimAt) return null;
      const remaining = CLAIM_COOLDOWN_MS - (Date.now() - state.lastClaimAt);
      if (remaining <= 0) return null;
      
      const hours = Math.floor(remaining / (1000 * 60 * 60));
      const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
      return `${hours}h ${minutes}m`;
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const icon = document.getElementById('toast-icon');
      const msg = document.getElementById('toast-message');
      
      toast.className = `toast ${type}`;
      icon.textContent = type === 'success' ? '‚ú®' : 'üòø';
      msg.textContent = message;
      
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function spawnHearts(container) {
      const particles = document.createElement('div');
      particles.className = 'feed-particles';
      container.appendChild(particles);
      
      const emojis = ['‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üêü', '‚ú®'];
      for (let i = 0; i < 8; i++) {
        const heart = document.createElement('span');
        heart.className = 'heart';
        heart.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        heart.style.left = `${Math.random() * 100 - 50}px`;
        heart.style.animationDelay = `${i * 0.1}s`;
        particles.appendChild(heart);
      }
      
      setTimeout(() => particles.remove(), 1500);
    }

    function generateId() {
      return 'cat_' + Math.random().toString(36).substr(2, 9);
    }

    // ============================================
    // STORAGE
    // ============================================
    function loadState() {
      const saved = localStorage.getItem('catTvState');
      if (saved) {
        state = JSON.parse(saved);
      } else {
        // New user starts with 0 balance, no claim yet
        state.userId = 'user_' + Math.random().toString(36).substr(2, 9);
        state.balance = 0;
        state.lastClaimAt = null;
        saveState();
      }
    }
    
    // Dev helper: reset state to test claim button
    function resetState() {
      localStorage.removeItem('catTvState');
      localStorage.removeItem('catTvCats');
      location.reload();
    }

    function saveState() {
      localStorage.setItem('catTvState', JSON.stringify(state));
    }

    function loadCats() {
      const saved = localStorage.getItem('catTvCats');
      if (saved) {
        cats = JSON.parse(saved);
      }
    }

    function saveCats() {
      localStorage.setItem('catTvCats', JSON.stringify(cats));
    }

    // ============================================
    // FILE UPLOAD
    // ============================================
    function openFileDialog() {
      document.getElementById('file-input').click();
    }

    function handleFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;

      // Check file size (limit to 5MB for localStorage)
      if (file.size > 5 * 1024 * 1024) {
        showToast('File too large! Max 5MB.', 'error');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        pendingFile = {
          data: e.target.result,
          type: file.type.startsWith('video') ? 'video' : 'image'
        };
        showModal();
      };
      reader.readAsDataURL(file);
      
      // Reset input so same file can be selected again
      event.target.value = '';
    }

    // ============================================
    // MODAL
    // ============================================
    function showModal() {
      const overlay = document.getElementById('modal-overlay');
      const preview = document.getElementById('modal-preview');
      const nameInput = document.getElementById('cat-name-input');
      
      // Show preview
      if (pendingFile.type === 'video') {
        preview.innerHTML = `<video src="${pendingFile.data}" autoplay loop muted playsinline></video>`;
      } else {
        preview.innerHTML = `<img src="${pendingFile.data}" alt="Preview">`;
      }
      
      nameInput.value = '';
      overlay.classList.add('show');
      setTimeout(() => nameInput.focus(), 100);
    }

    function closeModal() {
      const overlay = document.getElementById('modal-overlay');
      overlay.classList.remove('show');
      pendingFile = null;
    }

    function closeModalOutside(event) {
      if (event.target.id === 'modal-overlay') {
        closeModal();
      }
    }

    function addCat() {
      const nameInput = document.getElementById('cat-name-input');
      const name = nameInput.value.trim() || 'Unnamed Cat';
      
      if (!pendingFile) return;

      const newCat = {
        id: generateId(),
        name: name,
        media: pendingFile.data,
        mediaType: pendingFile.type,
        totalFed: 0,
        lastFedAt: null,
        createdAt: Date.now()
      };

      cats.unshift(newCat);
      saveCats();
      closeModal();
      showToast(`${name} has joined Cat TV! üéâ`);
      updateUI();
    }

    // ============================================
    // DRAG & DROP
    // ============================================
    function setupDragDrop() {
      const grid = document.getElementById('cat-grid');
      
      grid.addEventListener('dragover', (e) => {
        e.preventDefault();
        const uploadCard = document.querySelector('.upload-card');
        if (uploadCard) uploadCard.classList.add('dragover');
      });

      grid.addEventListener('dragleave', (e) => {
        const uploadCard = document.querySelector('.upload-card');
        if (uploadCard && !e.relatedTarget?.closest('.upload-card')) {
          uploadCard.classList.remove('dragover');
        }
      });

      grid.addEventListener('drop', (e) => {
        e.preventDefault();
        const uploadCard = document.querySelector('.upload-card');
        if (uploadCard) uploadCard.classList.remove('dragover');
        
        const file = e.dataTransfer.files[0];
        if (file && (file.type.startsWith('image') || file.type.startsWith('video'))) {
          // Simulate file input event
          const fakeEvent = { target: { files: [file], value: '' } };
          handleFileSelect(fakeEvent);
        }
      });
    }

    // ============================================
    // ACTIONS
    // ============================================
    function claimDaily() {
      if (!canClaim()) {
        showToast('Already claimed today!', 'error');
        return;
      }
      
      state.balance += DAILY_AMOUNT;
      state.lastClaimAt = Date.now();
      saveState();
      
      showToast(`Claimed ${DAILY_AMOUNT} cat food! üêü`);
      updateUI();
    }

    function feedCat(catId) {
      if (state.balance < FEED_COST) {
        showToast('Not enough food! Come back tomorrow.', 'error');
        return;
      }
      
      const cat = cats.find(c => c.id === catId);
      if (!cat) return;
      
      state.balance -= FEED_COST;
      state.totalFeeds += 1;
      saveState();
      
      cat.totalFed += 1;
      cat.lastFedAt = Date.now();
      saveCats();
      
      const card = document.querySelector(`[data-cat-id="${catId}"]`);
      const btn = card.querySelector('.feed-btn');
      const imageContainer = card.querySelector('.cat-image-container');
      
      btn.classList.add('feeding');
      spawnHearts(imageContainer);
      setTimeout(() => btn.classList.remove('feeding'), 600);
      
      showToast(`${cat.name} says thank you! üò∏`);
      updateUI();
    }

    // ============================================
    // UI RENDERING
    // ============================================
    function renderUploadCard() {
      return `
        <div class="upload-card" onclick="openFileDialog()">
          <span class="upload-icon">üì∏</span>
          <span class="upload-text">Add a cat</span>
          <span class="upload-subtext">Drop photo or video here, or tap to browse</span>
        </div>
      `;
    }

    function renderCatCard(cat) {
      const happiness = getHappiness(cat.lastFedAt);
      const isVideo = cat.mediaType === 'video';
      
      return `
        <article class="cat-card" data-cat-id="${cat.id}">
          <div class="cat-image-container">
            ${isVideo 
              ? `<video src="${cat.media}" class="cat-video" autoplay loop muted playsinline></video>`
              : `<img src="${cat.media}" alt="${cat.name}" class="cat-image">`
            }
            <div class="happiness-badge ${happiness.level}">
              <span class="happiness-face">${happiness.emoji}</span>
              <span>${happiness.label}</span>
            </div>
          </div>
          <div class="cat-info">
            <h2 class="cat-name">${cat.name}</h2>
            <p class="cat-fed-count">Fed ${cat.totalFed} time${cat.totalFed !== 1 ? 's' : ''}</p>
            <button class="feed-btn" onclick="feedCat('${cat.id}')" ${state.balance < FEED_COST ? 'disabled' : ''}>
              <span>üêü</span>
              <span>Feed (10 food)</span>
            </button>
          </div>
        </article>
      `;
    }

    function renderCats() {
      const grid = document.getElementById('cat-grid');
      const uploadCard = renderUploadCard();
      const catCards = cats.map(renderCatCard).join('');
      grid.innerHTML = uploadCard + catCards;
    }

    function updateUI() {
      document.getElementById('balance').textContent = state.balance;
      
      const claimBtn = document.getElementById('claim-btn');
      const claimText = document.getElementById('claim-text');
      const nextClaim = document.getElementById('next-claim');
      
      if (canClaim()) {
        claimBtn.disabled = false;
        claimBtn.classList.remove('claimed');
        claimText.textContent = 'Claim Daily Food';
        nextClaim.textContent = '';
      } else {
        claimBtn.disabled = true;
        claimBtn.classList.add('claimed');
        claimText.textContent = 'Claimed Today ‚úì';
        const timeLeft = getTimeUntilClaim();
        nextClaim.textContent = timeLeft ? `Next claim in ${timeLeft}` : '';
      }
      
      const totalFeeds = cats.reduce((sum, cat) => sum + cat.totalFed, 0);
      const happyCats = cats.filter(cat => getHappiness(cat.lastFedAt).level === 'happy').length;
      
      document.getElementById('total-feeds').textContent = totalFeeds;
      document.getElementById('happy-cats').textContent = happyCats;
      document.getElementById('total-cats').textContent = cats.length;
      
      renderCats();
    }

    // ============================================
    // INIT
    // ============================================
    function init() {
      loadState();
      loadCats();
      setupDragDrop();
      updateUI();
      
      setInterval(() => {
        updateUI();
      }, 60000);
    }

    init();
  </script>
</body>
</html>
